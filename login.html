<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login - HalalMatch.com</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCSdpzhy_WVaLLAyFYjHpglChbjoY-hUGM",
      authDomain: "halalmatchcom786.firebaseapp.com",
      projectId: "halalmatchcom786",
      storageBucket: "halalmatchcom786.firebasestorage.app",
      messagingSenderId: "781367758589",
      appId: "1:781367758589:web:da4377d96fc07af0933894",
      measurementId: "G-1HBFGDECRF"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // Login form submission handler
    async function loginUser(email, password) {
      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        if (user.emailVerified) {
          // Store JWT token securely in cookie with HttpOnly and Secure flags
          const token = await user.getIdToken();
          document.cookie = `token=${token}; Secure; HttpOnly; SameSite=Strict; path=/; max-age=3600`;
          alert('Login successful! Redirecting to dashboard...');
          window.location.href = 'user-dashboard.html';
        } else {
          alert('Please verify your email before logging in.');
        }
      } catch (error) {
        alert('Login failed: ' + error.message);
      }
    }

    window.addEventListener('DOMContentLoaded', () => {
      const loginForm = document.getElementById('loginForm');
      loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value.trim();
        const password = document.getElementById('loginPassword').value;
        if (!email || !password) {
          alert('Please enter both email and password.');
          return;
        }
        loginUser(email, password);
      });
    });
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

    html {
      background: linear-gradient(135deg, #4A90E2 0%, #50E3C2 100%);
      min-height: 100vh;
    }
    body {
      font-family: 'Poppins', sans-serif;
      position: relative;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      color: #1f2937;
    }
    .bg-scrim {
      background: rgba(10,12,16,0.92);
      backdrop-filter: blur(1px);
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    .btn-3d {
      transform: translateY(0);
      transition: transform 160ms ease, box-shadow 160ms ease;
      box-shadow: 0 8px 18px rgba(0,0,0,0.35);
      text-shadow: 0 1px 2px rgba(255,255,255,0.5);
    }
    .btn-3d:hover {
      transform: translateY(-2px);
      box-shadow: 0 14px 26px rgba(0,0,0,0.45);
    }
    .card {
      background: rgba(0,0,0,0.8);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.5);
      max-width: 400px;
      margin: 2rem auto;
      padding: 2rem;
      color: white;
    }
    .card label {
      color: white;
    }
    .glossy-text {
      text-shadow: 0 0 10px rgba(255,255,255,0.5);
    }
    .form-input {
      background: rgba(0,0,0,0.8);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      padding: 12px;
      transition: all 0.3s ease;
      width: 100%;
      margin-bottom: 1rem;
      color: white;
    }
    .form-input:focus {
      outline: none;
      border-color: #D4AF37;
      box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
    }
    .user-type-btn {
      background: linear-gradient(135deg, #D4AF37 0%, #B8860B 100%);
      color: #1a1a1a;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s ease;
      border: 2px solid #D4AF37;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(212, 175, 55, 0.3);
      width: 100%;
    }
    .user-type-btn:hover {
      background: linear-gradient(135deg, #B8860B 0%, #D4AF37 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(212, 175, 55, 0.4);
    }
    .validation-error {
      color: #dc2626;
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
      display: none;
    }
  </style>
</head>
<body class="font-sans min-h-screen text-black">
  <header class="text-black p-4 shadow-lg" style="background: linear-gradient(135deg, #D4AF37 0%, #B8860B 100%);">
    <nav class="flex items-center">
      <a href="index.html" class="user-type-btn" style="padding: 6px 12px; font-size: 12px; width: auto; min-width: 60px;">Home</a>
      <h1 class="text-2xl font-bold flex-1 text-center">HalalMatch.com</h1>
    </nav>
  </header>

  <main>
    <div class="card max-w-md mx-auto">
      <h2 class="text-2xl font-bold mb-4">Login</h2>
      <form id="loginForm" class="text-left">
        <label for="loginEmail" class="block mb-1 font-semibold">Email *</label>
        <input type="email" id="loginEmail" name="loginEmail" required class="form-input" />
        <label for="loginPassword" class="block mb-1 font-semibold">Password *</label>
        <input type="password" id="loginPassword" name="loginPassword" required class="form-input" />
        <div id="loginError" class="validation-error"></div>
        <button type="submit" class="user-type-btn">Login</button>
      </form>
    </div>
  </main>

  <script>
    async function loginUser(email, password) {
      const loginError = document.getElementById('loginError');
      loginError.style.display = 'none';
      loginError.textContent = '';
      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        if (user.emailVerified) {
          const token = await user.getIdToken();
          document.cookie = `token=${token}; Secure; SameSite=Strict; path=/; max-age=3600`;
          alert('Login successful! Redirecting to profile submission...');
          window.location.href = 'submit-profile.html';
        } else {
          alert('Please verify your email before logging in.');
        }
      } catch (error) {
        if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
          loginError.style.display = 'block';
          loginError.textContent = 'Invalid Email or Password';
        } else {
          loginError.style.display = 'block';
          loginError.textContent = error.message;
        }
      }
    }

    document.getElementById('loginForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;
      if (!email || !password) {
        const loginError = document.getElementById('loginError');
        loginError.style.display = 'block';
        loginError.textContent = 'Please enter both email and password.';
        return;
      }
      loginUser(email, password);
    });
  </script>
</body>
</html>
