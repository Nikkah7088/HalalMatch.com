<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sign Up - HalalMatch.com</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <!-- EmailJS SDK -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, sendEmailVerification, updateProfile, signInWithEmailAndPassword, applyActionCode } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
    import { translatePage, initLanguageSelector } from "./translations.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCSdpzhy_WVaLLAyFYjHpglChbjoY-hUGM",
      authDomain: "halalmatchcom786.firebaseapp.com",
      projectId: "halalmatchcom786",
      storageBucket: "halalmatchcom786.firebasestorage.app",
      messagingSenderId: "781367758589",
      appId: "1:781367758589:web:da4377d96fc07af0933894",
      measurementId: "G-1HBFGDECRF"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // Initialize EmailJS (replace with your actual user ID)
    emailjs.init('your_user_id');

    // Make auth globally available
    window.auth = auth;
    window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
    window.sendEmailVerification = sendEmailVerification;
    window.updateProfile = updateProfile;

    // Initialize language selector and translate page
    window.addEventListener('DOMContentLoaded', () => {
      initLanguageSelector();
      translatePage();
    });
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Georgia:wght@400;700&display=swap');

    html {
      background: linear-gradient(135deg, #D4AF37 0%, #87CEEB 100%);
      min-height: 100vh;
    }
    body {
      font-family: 'Georgia', serif;
      position: relative;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      color: #000000;
    }

    .bg-scrim {
      background: rgba(10,12,16,0.92);
      backdrop-filter: blur(1px);
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    .btn-3d {
      transform: translateY(0);
      transition: transform 160ms ease, box-shadow 160ms ease;
      box-shadow: 0 8px 18px rgba(0,0,0,0.35);
      text-shadow: 0 1px 2px rgba(255,255,255,0.5);
    }
    .btn-3d:hover {
      transform: translateY(-2px);
      box-shadow: 0 14px 26px rgba(0,0,0,0.45);
    }
    .premium-card {
      background: linear-gradient(145deg, rgba(255,255,255,0.98) 0%, rgba(250,250,250,0.95) 100%);
      border: 3px solid #D4AF37;
      border-radius: 20px;
      box-shadow: 0 25px 70px rgba(212, 175, 55, 0.5), 0 0 40px rgba(212, 175, 55, 0.3), inset 0 2px 0 rgba(255,255,255,0.8), inset 0 -2px 0 rgba(212, 175, 55, 0.1);
      backdrop-filter: blur(10px);
      padding: 2rem;
    }
    .glossy-text {
      text-shadow: 0 0 10px rgba(255,255,255,0.5);
    }
    .form-input {
      background: rgba(255,255,255,0.95);
      border: 2px solid #D4AF37;
      border-radius: 12px;
      padding: 14px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(212, 175, 55, 0.2);
      font-size: 16px;
    }
    .form-input:focus {
      outline: none;
      border-color: #B8860B;
      box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.3), 0 6px 16px rgba(212, 175, 55, 0.4);
      transform: translateY(-2px);
    }
    .user-type-btn {
      background: linear-gradient(135deg, #D4AF37 0%, #B8860B 100%);
      color: #000000;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s ease;
      border: 2px solid #D4AF37;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(212, 175, 55, 0.3);
    }
    .user-type-btn:hover {
      background: linear-gradient(135deg, #B8860B 0%, #D4AF37 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(212, 175, 55, 0.4);
    }
    .validation-error {
      color: #dc2626;
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
    }
  </style>
</head>
<body class="font-sans min-h-screen text-white">
  <header class="text-black p-4 shadow-lg" style="background: linear-gradient(135deg, #D4AF37 0%, #B8860B 100%);">
    <nav class="flex justify-between items-center">
      <h1 class="text-2xl font-bold glossy-text">HalalMatch.com</h1>
      <a href="index.html" class="user-type-btn">Home</a>
    </nav>
  </header>

  <main class="p-4 md:p-6">
    <div class="max-w-4xl mx-auto">
      <div class="premium-card">
        <h2 class="text-2xl font-bold mb-4 text-black">Sign Up</h2>
        <p class="mb-4 text-lg text-black font-semibold">Create your account to start your journey towards finding your perfect match.</p>
        <form id="signupForm" class="text-left">
          <div class="mb-4">
          <label for="signupName" class="block mb-1 font-semibold text-black">Name *</label>
            <input type="text" id="signupName" name="signupName" required class="form-input text-black w-full" />
          </div>
          <div class="mb-4">
            <label for="signupEmail" class="block mb-1 font-semibold text-black">Email *</label>
            <div class="flex">
              <input type="email" id="signupEmail" name="signupEmail" required class="form-input text-black flex-1" />
              <button type="button" id="sendOtpBtn" class="user-type-btn ml-2">Send OTP</button>
            </div>
          </div>
          <div class="mb-4" id="otpSection" style="display: none;">
            <label for="otpInput" class="block mb-1 font-semibold text-black">OTP *</label>
            <div class="flex">
              <input type="text" id="otpInput" name="otpInput" required class="form-input text-black flex-1" />
              <button type="button" id="confirmOtpBtn" class="user-type-btn ml-2">Confirm OTP</button>
            </div>
          </div>
          <div class="mb-4">
          <label for="signupPhone" class="block mb-1 font-semibold text-black">Phone *</label>
            <input type="tel" id="signupPhone" name="signupPhone" required class="form-input text-black w-full" />
          </div>
          <div class="mb-4">
          <label for="signupPassword" class="block mb-1 font-semibold text-black">Password *</label>
            <input type="password" id="signupPassword" name="signupPassword" required class="form-input text-black w-full" />
            <div id="passwordStrength" class="mt-2">
              <div class="flex space-x-1">
                <div id="strength-weak" class="h-2 w-1/3 bg-gray-300 rounded"></div>
                <div id="strength-medium" class="h-2 w-1/3 bg-gray-300 rounded"></div>
                <div id="strength-strong" class="h-2 w-1/3 bg-gray-300 rounded"></div>
              </div>
              <p id="strength-text" class="text-sm mt-1 text-black">Password strength: Weak</p>
            </div>
          </div>
          <div class="mb-4">
          <label for="signupConfirmPassword" class="block mb-1 font-semibold text-black">Confirm Password *</label>
            <input type="password" id="signupConfirmPassword" name="signupConfirmPassword" required class="form-input text-black w-full" />
          </div>
          <div id="signupError" class="validation-error hidden"></div>
          <div id="signupSuccess" class="text-green-500 font-semibold mb-4 hidden"></div>
          <button type="submit" class="user-type-btn w-full" id="createAccountBtn" disabled>Create Account</button>
        </form>
        <p class="mt-4 text-center text-black">Already have an account? <a href="login.html" class="text-black hover:underline">Login here</a></p>
        <p class="mt-2 text-center text-black text-sm">We verify Gmail only to keep the platform secure and free from fake accounts.</p>
      </div>


    </div>
  </main>

  <script>
    // Password strength checker
    document.getElementById('signupPassword').addEventListener('input', function() {
      const password = this.value;
      const strength = checkPasswordStrength(password);
      updatePasswordStrengthUI(strength);
    });

    function isDisposableEmail(email) {
      const disposableDomains = ['tempmail.com', 'yopmail.com', '10minutemail.com', 'guerrillamail.com', 'mailinator.com', 'temp-mail.org', 'throwaway.email', 'fakeinbox.com', 'maildrop.cc', 'tempail.com'];
      const domain = email.split('@')[1];
      return disposableDomains.includes(domain.toLowerCase());
    }

    function checkPasswordStrength(password) {
      let score = 0;
      if (password.length >= 8) score++;
      if (/[a-z]/.test(password)) score++;
      if (/[A-Z]/.test(password)) score++;
      if (/[0-9]/.test(password)) score++;
      if (/[^A-Za-z0-9]/.test(password)) score++;
      return score;
    }

    function updatePasswordStrengthUI(score) {
      const weak = document.getElementById('strength-weak');
      const medium = document.getElementById('strength-medium');
      const strong = document.getElementById('strength-strong');
      const text = document.getElementById('strength-text');

      weak.className = 'h-2 w-1/3 rounded';
      medium.className = 'h-2 w-1/3 rounded';
      strong.className = 'h-2 w-1/3 rounded';

      if (score <= 2) {
        weak.classList.add('bg-red-500');
        medium.classList.add('bg-gray-300');
        strong.classList.add('bg-gray-300');
        text.textContent = 'Password strength: Weak';
        text.className = 'text-sm mt-1 text-red-600';
      } else if (score <= 4) {
        weak.classList.add('bg-yellow-500');
        medium.classList.add('bg-yellow-500');
        strong.classList.add('bg-gray-300');
        text.textContent = 'Password strength: Medium';
        text.className = 'text-sm mt-1 text-yellow-600';
      } else {
        weak.classList.add('bg-green-500');
        medium.classList.add('bg-green-500');
        strong.classList.add('bg-green-500');
        text.textContent = 'Password strength: Strong';
        text.className = 'text-sm mt-1 text-green-600';
      }
    }

    // Signup form submission handler
    document.getElementById('signupForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      clearSignupMessages();

      if (!otpConfirmed) {
        showSignupError('Please verify your email with OTP first.');
        return;
      }

      const name = document.getElementById('signupName').value.trim();
      const email = document.getElementById('signupEmail').value.trim();
      const phone = document.getElementById('signupPhone').value.trim();
      const password = document.getElementById('signupPassword').value;
      const confirmPassword = document.getElementById('signupConfirmPassword').value;

      if (!name || !email || !phone || !password || !confirmPassword) {
        showSignupError('Please fill in all required fields.');
        return;
      }

      if (password !== confirmPassword) {
        showSignupError('Passwords do not match.');
        return;
      }

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        // Update display name to name
        await updateProfile(user, { displayName: name });

        // Send email verification
        await sendEmailVerification(user);

        alert('Account created! Please check your email for verification link, then login.');
        window.location.href = 'login.html?return=submit-profile.html';
      } catch (error) {
        showSignupError(error.message);
      }
    });

    function clearSignupMessages() {
      document.getElementById('signupError').classList.add('hidden');
      document.getElementById('signupSuccess').classList.add('hidden');
      document.getElementById('signupError').textContent = '';
      document.getElementById('signupSuccess').textContent = '';
    }

    function showSignupError(message) {
      const errorDiv = document.getElementById('signupError');
      errorDiv.textContent = message;
      errorDiv.classList.remove('hidden');
    }
  </script>
  <script>
    // OTP send and confirm logic
    const sendOtpBtn = document.getElementById('sendOtpBtn');
    const confirmOtpBtn = document.getElementById('confirmOtpBtn');
    const otpSection = document.getElementById('otpSection');
    const createAccountBtn = document.getElementById('createAccountBtn');
    let otpSent = false;
    let otpConfirmed = false;
    let otpSentTime = 0;

    sendOtpBtn.addEventListener('click', async () => {
      const email = document.getElementById('signupEmail').value.trim();
      if (!email) {
        alert('Please enter your email before sending OTP.');
        return;
      }
      const domain = email.split('@')[1];
      if (domain.toLowerCase() !== 'gmail.com') {
        alert('Please use a valid Gmail address.');
        return;
      }
      if (isDisposableEmail(email)) {
        alert('Disposable email addresses are not allowed.');
        return;
      }
      if (otpSent && Date.now() - otpSentTime < 60000) {
        alert('Please wait before requesting another OTP.');
        return;
      }
      // Generate 6-digit OTP
      const generatedOtp = Math.floor(100000 + Math.random() * 900000).toString();
      // Store OTP and timestamp in localStorage
      localStorage.setItem('signupOtp', generatedOtp);
      localStorage.setItem('signupOtpTime', Date.now().toString());
      otpSent = true;
      otpSentTime = Date.now();
      otpSection.style.display = 'block';

      // Send OTP email using EmailJS
      const templateParams = {
        to_email: email,
        otp_code: generatedOtp,
      };
      emailjs.send('your_service_id', 'your_template_id', templateParams)
        .then(() => {
          alert('OTP sent to your Gmail. Please check your inbox.');
        }, (error) => {
          alert('Failed to send OTP email. Please try again later.');
          console.error('EmailJS error:', error);
        });
    });

    confirmOtpBtn.addEventListener('click', async () => {
      if (!otpSent) {
        alert('Please send OTP first.');
        return;
      }
      const otp = document.getElementById('otpInput').value.trim();
      if (!otp) {
        alert('Please enter the OTP.');
        return;
      }
      const storedOtp = localStorage.getItem('signupOtp');
      const otpTime = localStorage.getItem('signupOtpTime');
      if (!storedOtp || !otpTime) {
        alert('OTP expired or not found. Please request a new one.');
        return;
      }
      const timeDiff = Date.now() - parseInt(otpTime);
      if (timeDiff > 10 * 60 * 1000) { // 10 minutes
        alert('OTP has expired. Please request a new one.');
        localStorage.removeItem('signupOtp');
        localStorage.removeItem('signupOtpTime');
        return;
      }
      if (otp === storedOtp) {
        otpConfirmed = true;
        alert('OTP confirmed. You can now create your account.');
        createAccountBtn.disabled = false;
      } else {
        alert('Invalid OTP. Please try again.');
      }
    });
  </script>
</body>
</html>
